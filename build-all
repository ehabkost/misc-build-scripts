#!/bin/bash
set -e

mydir="$(dirname "$0")"
export BUILD_ARGS=("$@")

export ERRORS=

B() {
	local name="$1"
	shift
	if ! ( cd "$name" && make "${BUILD_ARGS[@]}"; );then
		echo "ERROR: Build of ${name} failed" >&2
		ERRORS="$ERRORS ${name}"
	fi
}

source "$mydir/build-names"

if [ -n "$ERRORS" ];then
	echo ERRORS ABOVE: $ERRORS >&2
	exit 1
fi
